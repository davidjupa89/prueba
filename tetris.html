<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juego de Tetris NeÃ³n</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --background: #0a0a0a;
            --surface: rgba(20, 20, 30, 0.6);
            --game-area: rgba(10, 10, 10, 0.8);
            --primary-text: #f0f0f0;
            --secondary-text: #888;
            --border-color: rgba(0, 255, 255, 0.3);
            --glow-color: #00ffff;
            --danger-color: #ff0066;
            --font: 'Orbitron', sans-serif;
        }

        body {
            background-color: var(--background);
            color: var(--primary-text);
            font-family: var(--font);
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            text-align: center;
            flex-direction: column;
            overflow: hidden;
        }

        .game-wrapper {
            display: flex;
            flex-direction: row;
            align-items: flex-start;
            gap: 30px;
            padding: 30px;
            background: var(--surface);
            border-radius: 20px;
            border: 1px solid var(--border-color);
            box-shadow: 0 0 25px rgba(0, 255, 255, 0.2), inset 0 0 10px rgba(0, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }
        
        #main-canvas {
            border-radius: 10px;
            box-shadow: 0 0 15px var(--glow-color);
        }

        .info-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
            width: 180px;
            font-size: 1rem;
        }

        .info-box {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid var(--border-color);
            text-transform: uppercase;
            font-weight: 700;
            letter-spacing: 1px;
            color: var(--secondary-text);
            position: relative;
        }
        
        .info-box span {
            display: block;
            margin-top: 10px;
            color: var(--primary-text);
            font-size: 2rem;
        }

        .next-piece-box {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #next-canvas {
            background-color: transparent;
        }
        
        #mute-button {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 30px;
            height: 30px;
            background: transparent;
            border: 1px solid var(--secondary-text);
            color: var(--secondary-text);
            cursor: pointer;
            border-radius: 5px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.2rem;
            transition: all 0.2s ease;
        }
        #mute-button:hover {
            border-color: var(--glow-color);
            color: var(--glow-color);
        }

        /* --- Animaciones --- */
        @keyframes pulse {
            0% { box-shadow: 0 0 15px var(--glow-color); }
            50% { box-shadow: 0 0 30px #fff, 0 0 45px var(--glow-color); }
            100% { box-shadow: 0 0 15px var(--glow-color); }
        }
        .pulse-animation { animation: pulse 0.4s ease-in-out; }

        @keyframes shake {
          0%, 100% { transform: translateX(0); }
          25% { transform: translateX(-5px); }
          50% { transform: translateX(5px); }
          75% { transform: translateX(-5px); }
        }
        .shake-animation { animation: shake 0.3s linear; }

        #gameOverMessage {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(10, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            padding: 40px;
            border-radius: 20px;
            border: 1px solid var(--danger-color);
            flex-direction: column;
            align-items: center;
            gap: 20px;
            box-shadow: 0 0 20px var(--danger-color);
        }
        #gameOverMessage h2 {
            font-size: 2.5rem;
            color: var(--danger-color);
            margin: 0;
            text-shadow: 0 0 10px var(--danger-color);
        }
        #restartButton {
            font-family: var(--font);
            font-size: 1.2rem;
            font-weight: 700;
            padding: 15px 30px;
            border: 1px solid var(--glow-color);
            background: transparent;
            color: var(--glow-color);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            text-shadow: 0 0 5px var(--glow-color);
        }
        #restartButton:hover {
            background: var(--glow-color);
            color: var(--background);
            box-shadow: 0 0 20px var(--glow-color);
        }

        @media (max-width: 768px) {
            .game-wrapper { flex-direction: column; padding: 15px; gap: 15px; }
            .info-panel { flex-direction: row; width: 100%; justify-content: space-around; }
            .info-box { width: 30%; padding: 10px; }
            .info-box span { font-size: 1.5rem; }
            .next-piece-box { width: 100%; }
            #mute-button { position: static; margin-left: auto; }
        }
    </style>
</head>
<body>

    <div class="game-wrapper">
        <canvas id="main-canvas" width="300" height="600"></canvas>
        <div class="info-panel">
            <div class="info-box">Score<span id="score">0</span></div>
            <div class="info-box">Lines<span id="lines">0</span></div>
            <div class="info-box">Level<span id="level">0</span></div>
            <div class="info-box next-piece-box">
                Next
                <canvas id="next-canvas" width="120" height="120"></canvas>
                 <button id="mute-button">ðŸ”Š</button>
            </div>
        </div>
    </div>
    
    <div id="gameOverMessage">
        <h2>GAME OVER</h2>
        <button id="restartButton">Reiniciar</button>
    </div>

    <script>
        // --- CONFIGURACIÃ“N INICIAL ---
        const mainCanvas = document.getElementById('main-canvas');
        const mainContext = mainCanvas.getContext('2d');
        const nextCanvas = document.getElementById('next-canvas');
        const nextContext = nextCanvas.getContext('2d');
        
        const scoreElement = document.getElementById('score');
        const linesElement = document.getElementById('lines');
        const levelElement = document.getElementById('level');
        const gameOverMessage = document.getElementById('gameOverMessage');
        const restartButton = document.getElementById('restartButton');
        const gameWrapper = document.querySelector('.game-wrapper');
        const muteButton = document.getElementById('mute-button');

        const COLS = 10;
        const ROWS = 20;
        const BLOCK_SIZE = 30;
        const NEXT_BLOCK_SIZE = 30;

        mainContext.scale(BLOCK_SIZE, BLOCK_SIZE);
        nextContext.scale(NEXT_BLOCK_SIZE, NEXT_BLOCK_SIZE);

        const PIECES = [ [], [[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0]], [[2,2],[2,2]], [[0,3,0],[3,3,3],[0,0,0]], [[4,4,0],[0,4,4],[0,0,0]], [[0,5,5],[5,5,0],[0,0,0]], [[0,0,6],[6,6,6],[0,0,0]], [[7,0,0],[7,7,7],[0,0,0]] ];
        const COLORS = [ null, '#00ffff', '#ffff00', '#ff00ff', '#00ff00', '#ff6600', '#6600ff', '#ff0066' ];
        
        let arena = createMatrix(COLS, ROWS);
        let player = { pos: {x:0, y:0}, matrix: null, next: null, score: 0, level: 0, lines: 0 };
        let dropCounter = 0, dropInterval = 1000, lastTime = 0, gameRunning = true;
        
        // --- AUDIO ---
        let audioCtx, gainNode, isMuted = false, audioInitialized = false;
        const melody = [
            { note: 261.63, duration: 0.15 }, { note: 392.00, duration: 0.15 }, { note: 311.13, duration: 0.15 }, { note: 392.00, duration: 0.15 },
            { note: 261.63, duration: 0.15 }, { note: 392.00, duration: 0.15 }, { note: 311.13, duration: 0.15 }, { note: 392.00, duration: 0.15 },
            { note: 246.94, duration: 0.15 }, { note: 392.00, duration: 0.15 }, { note: 349.23, duration: 0.15 }, { note: 392.00, duration: 0.15 },
            { note: 246.94, duration: 0.15 }, { note: 392.00, duration: 0.15 }, { note: 349.23, duration: 0.15 }, { note: 392.00, duration: 0.15 },
        ];
        let melodyTimeout, currentNote = 0;

        function initAudio() {
            if (audioInitialized) return;
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            gainNode = audioCtx.createGain();
            gainNode.connect(audioCtx.destination);
            gainNode.gain.value = isMuted ? 0 : 0.1; // Iniciar con volumen bajo
            audioInitialized = true;
            playMelody();
        }

        function playNote(note, duration) {
            if (!audioCtx) return;
            const oscillator = audioCtx.createOscillator();
            oscillator.type = 'square';
            oscillator.frequency.setValueAtTime(note, audioCtx.currentTime);
            oscillator.connect(gainNode);
            oscillator.start();
            oscillator.stop(audioCtx.currentTime + duration);
        }
        
        function playMelody() {
            if (isMuted || !gameRunning) return;
            const { note, duration } = melody[currentNote];
            playNote(note, duration);
            currentNote = (currentNote + 1) % melody.length;
            melodyTimeout = setTimeout(playMelody, duration * 1000 * 1.5);
        }

        function toggleMute() {
            if (!audioInitialized) initAudio();
            isMuted = !isMuted;
            muteButton.textContent = isMuted ? 'ðŸ”‡' : 'ðŸ”Š';
            gainNode.gain.setValueAtTime(isMuted ? 0 : 0.1, audioCtx.currentTime);
            if (!isMuted) {
                clearTimeout(melodyTimeout);
                playMelody();
            } else {
                clearTimeout(melodyTimeout);
            }
        }
        muteButton.addEventListener('click', toggleMute);

        // --- FUNCIONES DEL JUEGO ---
        function createMatrix(w, h) { const m = []; while(h--) m.push(new Array(w).fill(0)); return m; }
        function drawBlock(ctx, val, x, y) {
            const color = COLORS[val]; ctx.fillStyle = color; ctx.fillRect(x,y,1,1);
            const grad = ctx.createLinearGradient(x,y,x+1,y+1); grad.addColorStop(0,'rgba(255,255,255,0.3)'); grad.addColorStop(1,'rgba(0,0,0,0.3)');
            ctx.fillStyle = grad; ctx.fillRect(x,y,1,1);
        }
        function drawMatrix(ctx, matrix, offset) { matrix.forEach((r,y) => r.forEach((v,x) => { if(v!==0) drawBlock(ctx, v, x + offset.x, y + offset.y); })); }
        function draw() {
            mainContext.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--game-area').trim();
            mainContext.fillRect(0,0,mainCanvas.width,mainCanvas.height);
            drawMatrix(mainContext, arena, {x:0,y:0}); drawMatrix(mainContext, player.matrix, player.pos);
            nextContext.fillStyle = 'transparent'; nextContext.fillRect(0,0,nextCanvas.width,nextCanvas.height);
            const nextM = PIECES[player.next];
            drawMatrix(nextContext, nextM, {x:(nextCanvas.width/NEXT_BLOCK_SIZE/2)-(nextM[0].length/2), y:(nextCanvas.height/NEXT_BLOCK_SIZE/2)-(nextM.length/2)});
        }
        function merge() { player.matrix.forEach((r,y) => r.forEach((v,x) => { if(v!==0) arena[y+player.pos.y][x+player.pos.x] = v; })); }
        function collide() {
            const [m,o] = [player.matrix, player.pos];
            for(let y=0; y<m.length; ++y) for(let x=0; x<m[y].length; ++x) if(m[y][x]!==0 && (arena[y+o.y]&&arena[y+o.y][x+o.x])!==0) return true;
            return false;
        }
        function playerDrop() { if(!gameRunning) return; player.pos.y++; if(collide()) { player.pos.y--; merge(); playerReset(); arenaSweep(); updateScore(); } dropCounter=0; }
        function playerHardDrop() { if(!gameRunning) return; while(!collide()) player.pos.y++; player.pos.y--; merge(); playerReset(); arenaSweep(); updateScore(); dropCounter=0; }
        function playerMove(dir) { if(!gameRunning) return; player.pos.x+=dir; if(collide()) player.pos.x-=dir; }
        function playerRotate() {
            const pos = player.pos.x; let offset=1; rotate(player.matrix);
            while(collide()){ player.pos.x+=offset; offset=-(offset+(offset>0?1:-1)); if(offset>player.matrix[0].length) {rotate(player.matrix,-1);player.pos.x=pos;return;}}
        }
        function rotate(m, dir=1) { for(let y=0;y<m.length;++y) for(let x=0;x<y;++x) [m[x][y],m[y][x]]=[m[y][x],m[x][y]]; if(dir>0) m.forEach(r=>r.reverse()); else m.reverse(); }
        function randomPiece() { return Math.floor(Math.random()*(PIECES.length-1))+1; }
        function playerReset() {
            player.matrix = PIECES[player.next]; player.next = randomPiece(); player.pos.y=0;
            player.pos.x = (COLS/2|0)-(player.matrix[0].length/2|0);
            if(collide()) {
                gameRunning = false;
                clearTimeout(melodyTimeout);
                gameOverMessage.style.display = 'flex';
                gameWrapper.classList.add('shake-animation');
            }
        }
        function arenaSweep() {
            let cleared = 0;
            outer: for(let y=arena.length-1; y>0; --y) {
                for(let x=0; x<arena[y].length; ++x) if(arena[y][x]===0) continue outer;
                const r = arena.splice(y,1)[0].fill(0); arena.unshift(r); y++; cleared++;
            }
            if(cleared>0){
                player.score += [0,40,100,300,1200][cleared] * (player.level+1);
                player.lines += cleared;
                mainCanvas.classList.add('pulse-animation'); setTimeout(()=>mainCanvas.classList.remove('pulse-animation'), 400);
            }
        }
        function updateScore() {
            scoreElement.innerText = player.score; linesElement.innerText = player.lines;
            const newLevel = Math.floor(player.lines/10);
            if(newLevel > player.level){ player.level=newLevel; dropInterval = 1000/(player.level*0.75+1); }
            levelElement.innerText = player.level;
        }
        function update(time=0) {
            if(!gameRunning) return;
            const dT = time-lastTime; lastTime=time; dropCounter+=dT;
            if(dropCounter>dropInterval) playerDrop();
            draw(); requestAnimationFrame(update);
        }
        document.addEventListener('keydown', e => {
            if(!gameRunning) return;
            if(e.key==='ArrowLeft') playerMove(-1); else if(e.key==='ArrowRight') playerMove(1);
            else if(e.key==='ArrowDown') playerDrop(); else if(e.key==='ArrowUp') playerRotate();
            else if(e.key===' '){ e.preventDefault(); playerHardDrop(); }
        });
        function startGame() {
            if (!audioInitialized) initAudio();
            gameRunning=true; gameWrapper.classList.remove('shake-animation'); gameOverMessage.style.display='none';
            arena.forEach(r=>r.fill(0)); player.score=0; player.lines=0; player.level=0;
            updateScore(); dropInterval=1000; player.next=randomPiece(); playerReset();
            clearTimeout(melodyTimeout);
            playMelody();
            update();
        }
        restartButton.addEventListener('click', startGame);
        startGame();

    </script>
</body>
</html>
